# ๐ ะัะพะณะพะฒัะน ะพััะตั: ะะฝัะตะณัะฐัะธั Admin API

## โ ะงัะพ ัะดะตะปะฐะฝะพ

### 1. ะกะพะทะดะฐะฝ ะบะปะธะตะฝั ะดะปั Admin API
**ะคะฐะนะป:** `admin_api_client.py`

ะะปะธะตะฝั ัะผะตะตั:
- โ ะะพะปััะฐัั ัะฟะธัะพะบ ัะตััะธะน ั ัะธะปัััะฐัะธะตะน (frozen, deleted, spamblock)
- โ ะะพะปััะฐัั ัะตััะธั ะฟะพ ID
- โ ะะพะปััะฐัั ัะตััะธั ะฟะพ ะฝะพะผะตัั ัะตะปะตัะพะฝะฐ
- โ ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟะฐะณะธะฝะฐัะธั ะดะปั ะฑะพะปััะธั ัะฟะธัะบะพะฒ
- โ ะัะฐะฒะธะปัะฝะฐั ะฐะฒัะพัะธะทะฐัะธั ัะตัะตะท Bearer token

### 2. ะะฑะฝะพะฒะปะตะฝะฐ ะบะพะฝัะธะณััะฐัะธั
**ะคะฐะนะป:** `config.py`

ะะพะฑะฐะฒะปะตะฝะพ:
```python
admin_api_base_url: str = "https://adminapi.knyazservice.com"
```

ะัะฟะพะปัะทัะตั ัััะตััะฒัััะธะน ะบะปัั ะธะท `.env`:
```bash
TELEGRAM_API_KEY=5dace6994b016356dcb94546f0203b26e128985bf71e02ca619feafa07c0442a
```

### 3. ะกะพะทะดะฐะฝ ัะบัะธะฟั ัะธะฝััะพะฝะธะทะฐัะธะธ
**ะคะฐะนะป:** `sync_session_statuses.py`

ะกะธะฝััะพะฝะธะทะธััะตั ััะฐัััั ะธะท Admin API ะฒ ะปะพะบะฐะปัะฝัั ะะ:
- Frozen ัะตััะธะธ (is_frozen = 1)
- Deleted ัะตััะธะธ (is_deleted = 1)  
- Banned forever ัะตััะธะธ (is_banned = 1, unban_date = NULL)

### 4. ะขะตััั ะธ ะพััะตัั
- โ `test_admin_api.py` - ัะตััะธัะพะฒะฐะฝะธะต ะบะปะธะตะฝัะฐ
- โ `check_warmup_sessions.py` - ะฟัะพะฒะตัะบะฐ ะฟัะพะณัะตะฒะฐััะธััั ัะตััะธะน
- โ ะะฑะฝะพะฒะปะตะฝ `scripts/warmup_exclusion_report.py`

## ๐ ะะตะทัะปััะฐัั ัะธะฝััะพะฝะธะทะฐัะธะธ

### ะกัะฐัะธััะธะบะฐ ะธะท Admin API (ะฒัะตะณะพ ะฒ ัะธััะตะผะต)
```
๐ง Frozen sessions:         436
โ Deleted sessions:        14,588
๐ซ Banned forever sessions: 348
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ Total problematic:       15,372
```

### ะกัะฐัะธััะธะบะฐ ะปะพะบะฐะปัะฝะพะน ะะ Heat_Up
```
ะัะตะณะพ ะฐะบะบะฐัะฝัะพะฒ: 63

โ ะ ะฟัะพะณัะตะฒะต:   35 (55.6%)
โ ะัะบะปััะตะฝะพ:    28 (44.4%)
   โข Frozen:     20
   โข Deleted:     8
```

### ะญะบะพะฝะพะผะธั ัะพะบะตะฝะพะฒ LLM
```
๐ ะ ะดะตะฝั:   ~224,000 ัะพะบะตะฝะพะฒ
๐ ะ ะผะตััั:  ~6,720,000 ัะพะบะตะฝะพะฒ
๐ต ะ ะผะตััั:  ~$0.94
```

## ๐ง ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั

### ะกะธะฝััะพะฝะธะทะฐัะธั ััะฐัััะพะฒ
```bash
cd /root/heat_up
python3 sync_session_statuses.py
```

### ะัะพะฒะตัะบะฐ ะพััะตัะฐ
```bash
python3 scripts/warmup_exclusion_report.py
```

### ะขะตััะธัะพะฒะฐะฝะธะต API
```bash
python3 test_admin_api.py
```

### ะกะฟะธัะพะบ ะฟัะพะณัะตะฒะฐััะธััั ัะตััะธะน
```bash
python3 check_warmup_sessions.py
```

## ๐ฏ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

1. **ะกะบัะธะฟั ัะธะฝััะพะฝะธะทะฐัะธะธ** ะทะฐะฟัะฐัะธะฒะฐะตั Admin API ะธ ะฟะพะปััะฐะตั ะฐะบััะฐะปัะฝัะต ััะฐัััั ะฒัะตั ัะตััะธะน
2. **ะะฑะฝะพะฒะปัะตั ะปะพะบะฐะปัะฝัั ะะ** heat_up, ะฟัะพััะฐะฒะปัั ัะปะฐะณะธ is_frozen, is_deleted ะดะปั ัะตััะธะน
3. **ะกะธััะตะผะฐ ะฟัะพะณัะตะฒะฐ** ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธัะบะปััะฐะตั ะฟัะพะฑะปะตะผะฝัะต ัะตััะธะธ ัะตัะตะท:
   - ะคัะฝะบัะธั `should_skip_warmup()` ะฒ `database.py`
   - SQL-ัะธะปััั ะฒ `get_accounts_for_warmup()`
4. **ะะปะฐะฝะธัะพะฒัะธะบ ะธ API** ะธัะฟะพะปัะทััั ััั ัะธะปัััะฐัะธั ะฐะฒัะพะผะฐัะธัะตัะบะธ

## โจ ะัะตะธะผััะตััะฒะฐ

### ะะพ ะธะฝัะตะณัะฐัะธะธ
- โ ะกัะฐัััั ะพะฑะฝะพะฒะปัะปะธัั ะฒัััะฝัั
- โ ะฃััะฐัะตะฒัะธะต ะดะฐะฝะฝัะต
- โ ะขัะฐัั ัะพะบะตะฝะพะฒ ะฝะฐ ะผะตััะฒัะต ัะตััะธะธ
- โ ะัะถะฝะพ ะฑัะปะพ ะปะตะทัั ะฒ ะฑะฐะทั Knyaz

### ะะพัะปะต ะธะฝัะตะณัะฐัะธะธ
- โ ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั
- โ ะะบััะฐะปัะฝัะต ะดะฐะฝะฝัะต ะธะท ะตะดะธะฝะพะณะพ ะธััะพัะฝะธะบะฐ
- โ ะญะบะพะฝะพะผะธั ัะพะบะตะฝะพะฒ LLM
- โ ะัะพััะพะน ัะบัะธะฟั ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั
- โ ะะต ะฝัะถะฝะพ ััะพะณะฐัั ะฑะฐะทั Knyaz

## ๐ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั API

### Python
```python
from admin_api_client import AdminAPIClient

client = AdminAPIClient()

# ะะพะปััะธัั ะฒัะต ะทะฐะผะพัะพะถะตะฝะฝัะต ัะตััะธะธ
frozen = await client.get_frozen_sessions()
print(f"Frozen: {len(frozen)}")

# ะะพะปััะธัั ัะตััะธั ะฟะพ ID
session = await client.get_session_by_id(27084)
print(session)

await client.close()
```

### Curl
```bash
# ะะพะปััะธัั ะทะฐะผะพัะพะถะตะฝะฝัะต ัะตััะธะธ
curl -H "Authorization: Bearer YOUR_KEY" \
  "https://adminapi.knyazservice.com/api/v1/sessions/?frozen=true&limit=5"

# ะะพะปััะธัั ัะตััะธั ะฟะพ ID  
curl -H "Authorization: Bearer YOUR_KEY" \
  "https://adminapi.knyazservice.com/api/v1/sessions/27084"
```

## ๐ ะะฒัะพะผะฐัะธะทะฐัะธั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

### ะะพะฑะฐะฒะธัั ะฒ crontab ะดะปั ะตะถะตะดะฝะตะฒะฝะพะน ัะธะฝััะพะฝะธะทะฐัะธะธ
```bash
# ะัะบัััั crontab
crontab -e

# ะะพะฑะฐะฒะธัั ัััะพะบั (ัะธะฝััะพะฝะธะทะฐัะธั ะฒ 2:00 ะฝะพัะธ)
0 2 * * * cd /root/heat_up && python3 sync_session_statuses.py >> /var/log/admin_sync.log 2>&1
```

## ๐ ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั

```
/root/heat_up/
โโโ admin_api_client.py                 # โญ ะะปะธะตะฝั Admin API
โโโ sync_session_statuses.py            # โญ ะกะบัะธะฟั ัะธะฝััะพะฝะธะทะฐัะธะธ
โโโ test_admin_api.py                   # โญ ะขะตััั ะบะปะธะตะฝัะฐ
โโโ check_warmup_sessions.py            # โญ ะัะพะฒะตัะบะฐ ะฟัะพะณัะตะฒะฐ
โโโ ADMIN_API_INTEGRATION_REPORT.md     # ๐ ะะพะปะฝัะน ัะตัะฝะธัะตัะบะธะน ะพััะตั
โโโ ADMIN_API_QUICK_START.md            # ๐ ะัััััะน ััะฐัั
โโโ ะะขะะะะะซะ_ะะขะงะะข_ADMIN_API.md         # ๐ ะญัะพั ัะฐะนะป
```

## ๐ ะะฐะบะปััะตะฝะธะต

ะะฝัะตะณัะฐัะธั Admin API **ะฟะพะปะฝะพัััั ะทะฐะฒะตััะตะฝะฐ ะธ ะฟัะพัะตััะธัะพะฒะฐะฝะฐ**. ะกะธััะตะผะฐ ะฟัะพะณัะตะฒะฐ ัะตะฟะตัั ะธัะฟะพะปัะทัะตั ะฐะบััะฐะปัะฝัะต ะดะฐะฝะฝัะต ะธะท ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะณะพ API, ััะพ:

- โ ะฃะปัััะฐะตั ะบะฐัะตััะฒะพ ะดะฐะฝะฝัั
- โ ะญะบะพะฝะพะผะธั ัะพะบะตะฝั LLM (~$1/ะผะตััั)
- โ ะฃะฟัะพัะฐะตั ะฐะดะผะธะฝะธัััะธัะพะฒะฐะฝะธะต
- โ ะัะบะปััะฐะตั 28 ะฟัะพะฑะปะตะผะฝัั ัะตััะธะน ะธะท 63

**ะกะตัะฒะธั ะฟะตัะตะทะฐะฟััะตะฝ** ะธ ัะฐะฑะพัะฐะตั ั ะฝะพะฒะพะน ะบะพะฝัะธะณััะฐัะธะตะน.

---

**ะะฐัะฐ:** 3 ะฝะพัะฑัั 2025  
**ะกัะฐััั:** โ **ะะะะะะจะะะ ะ ะะะะะขะะะข**

